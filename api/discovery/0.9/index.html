<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <title>
    Change Discovery API 0.9.2 BETA Documentation &mdash; IIIF | International Image Interoperability Framework
  </title>
  <meta name="description" content="">
  <link rel="shortcut icon" href="/iiif-website/assets/images/logo-sm.png">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/iiif-website/assets/css/style.css"></head>
<body>






<section class="hero is-primary" style="">
  
  <div class="hero-head">
    <nav id="navbar" class="navbar is-transparent is-spaced">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/iiif-website/">
        <img src="/iiif-website/assets/images/logo-sm.png" alt="International Image Interoperability Framework logo" height="28">
        <span class="brand-title">International Image Interoperability Framework</span>
      </a>
      <div class="navbar-burger" data-target="navbar" onclick="document.querySelector('.navbar-menu').classList.toggle('is-active');">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <div class="navbar-menu">
      <div class="navbar-end">
            <a class="navbar-item" href="/iiif-website/">Home</a>
          
            <a class="navbar-item" href="/iiif-website/demos">Demos</a>
          
            <a class="navbar-item" href="/iiif-website/news-and-events">News & Events</a>
          
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link"href="/iiif-website/get-involved">
                Get Involved
              </a>
              <div class="navbar-dropdown is-boxed is-active">
                
                  <a class="navbar-item" href="/iiif-website">Community Groups</a>
                
                  <a class="navbar-item" href="/iiif-website">Consortium</a>
                
                  <a class="navbar-item" href="/iiif-website">Join Newsletter</a>
                
                  <a class="navbar-item" href="/iiif-website">Contact Us</a>
                
              </div>
            </div>
          
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link"href="/iiif-website/get-started">
                Get Started
              </a>
              <div class="navbar-dropdown is-boxed is-active">
                
                  <a class="navbar-item" href="/iiif-website">How It Works</a>
                
                  <a class="navbar-item" href="/iiif-website/api">APIs & Documentation</a>
                
                  <a class="navbar-item" href="/iiif-website">Cookbooks</a>
                
                  <a class="navbar-item" href="/iiif-website">Training</a>
                
              </div>
            </div>
          </div>
    </div>
  </div>
</nav>

  </div>
  

  <div class="hero-body container">

    
    <nav class="breadcrumb is-centered" aria-label="breadcrumbs">
      <ul>
        
          <li><a href="/iiif-website/get-started">Get Started</a></li>
        
          <li><a href="/iiif-website/api">APIs & Documentation</a></li>
        
      </ul>
    </nav>
    

    <div class="container has-text-centered">
      
      <h1 class="title is-size-2 is-size-3-mobile is-size-desktop is-size-1-widescreen">Change Discovery API 0.9.2 BETA Documentation</h1>
      
      <p class="subtitle is-size-6"></p>

      
    </div>
  </div>
</section>
<section id="main">
      

<div class="container-block is-max-widescreen">
  <div class="columns container">
    <aside class="column is-one-third" markdown="1">
      <div class="box toc-sidebar sticky">
        <ul class="menu" id="toc-menu"><li><a href="#introduction">1. Introduction</a><ul class="menu-list toc-submenu-2"><li><a href="#objectives-and-scope">1.1. Objectives and Scope</a></li><li><a href="#terminology">1.2. Terminology</a></li></ul></li><li><a href="#overview-of-iiif-resource-discovery">2. Overview of IIIF Resource Discovery</a><ul class="menu-list toc-submenu-2"><li><a href="#resources-and-their-changes">2.1. IIIF Resources and their Changes</a></li><li><a href="#pages-of-changes">2.2. Pages of Changes</a></li><li><a href="#collections-of-pages">2.3. Collections of Pages</a></li><li><a href="#24-registries-of-collections">2.4. Registries of Collections</a></li></ul></li><li><a href="#activity-streams-details">3. Activity Streams Details</a><ul class="menu-list toc-submenu-2"><li><a href="#orderedcollection">3.1. Ordered Collection</a></li><li><a href="#ordered-collection-page">3.2. Ordered Collection Page</a></li><li><a href="#activities">3.3. Activities</a></li><li><a href="#34-linked-data-context-and-extensions">3.4. Linked Data Context and Extensions</a></li><li><a href="#activity-streams-processing-algorithm">3.5. Activity Streams Processing Algorithm</a></li></ul></li><li><a href="#4-network-considerations">4. Network Considerations</a><ul class="menu-list toc-submenu-2"><li><a href="#41-media-type">4.1. Media Type</a></li><li><a href="#42-activities-for-access-restricted-content">4.2. Activities for Access-Restricted Content</a></li><li><a href="#43-negotiable-resources">4.3. Negotiable Resources</a></li></ul></li><li><a href="#appendices">Appendices</a><ul class="menu-list toc-submenu-2"><li><a href="#acknowledgements">A. Acknowledgements</a></li><li><a href="#change-log">B. Change Log</a></li></ul></li></ul>

      </div>
    </aside>
    <div class="column content is-two-thirds api-content" markdown="1">
      <h2 class="no_toc" id="status-of-this-document">
        
        
          Status of this Document <a href="#status-of-this-document">#</a>
        
        
      </h2>
    
<p><strong>This Version:</strong> 0.9.2-BETA</p>

<p><strong>Latest Stable Version:</strong> None</p>

<p><strong>Previous Version:</strong> <a href="/iiif-website/api/discovery/0.4/" title="IIIF Change Discovery API">0.4</a></p>

<p><strong>Editors:</strong></p>

<ul>
  <li>
    <p><strong><a href="https://orcid.org/0000-0002-1266-298X">Michael Appleby</a></strong>, Yale University</p>
  </li>
  <li>
    <p><strong><a href="https://orcid.org/0000-0003-1881-243X">Tom Crane</a></strong>, Digirati</p>
  </li>
  <li>
    <p><strong><a href="https://orcid.org/0000-0003-4441-6852">Robert Sanderson</a></strong>, J. Paul Getty Trust</p>
  </li>
  <li>
    <p><strong><a href="https://orcid.org/0000-0002-0367-1243">Jon Stroop</a></strong>, Princeton University Library</p>
  </li>
  <li>
    <p><strong><a href="https://orcid.org/0000-0002-7970-7855">Simeon Warner</a></strong>, Cornell University</p>
  </li>
</ul>

<p><em>Copyright © 2012-2021 Editors and contributors. Published by the IIIF Consortium under the <a href="http://creativecommons.org/licenses/by/4.0/" title="Creative Commons &mdash; Attribution 4.0 International">CC-BY</a> license, see <a href="/iiif-website/api/annex/notes/disclaimer/">disclaimer</a>.</em></p><hr />
      <h2 id="introduction">
        
        
          1. Introduction <a href="#introduction">#</a>
        
        
      </h2>
    

<p>The resources made available via the IIIF (pronounced “Triple-Eye-Eff”) <a href="/iiif-website/api/image/./" title="Image API">Image</a> and <a href="/iiif-website/api/presentation/" title="IIIF Presentation API">Presentation</a> APIs are useful only if they can be found. Users cannot interact directly with a distributed, decentralized ecosystem but instead must rely on services that harvest and process the available content, and then provide a user interface enabling navigation to that content via searching, browsing or other paradigms. Once the user has discovered the content, they can then display it in their viewing application of choice. Machine to machine interfaces are also enabled by this approach, where software agents can interact via APIs to discover the same content and retrieve it for further analysis or processing.</p>

<p>This specification leverages existing techniques, specifications, and tools in order to promote widespread adoption of an easy-to-implement service. The service describes changes to IIIF content resources and the location of those resources to harvest. Content providers can implement this API to enable the collaborative development of global or thematic search engines and portal applications that ultimately allow users to easily find and engage with content available via existing IIIF APIs.</p>
      <h3 id="objectives-and-scope">
        
        
          1.1. Objectives and Scope <a href="#objectives-and-scope">#</a>
        
        
      </h3>
    

<p>The objective of the IIIF Change Discovery API is to provide a machine to machine API that provides the information needed to discover and subsequently make use of IIIF resources. The intended audience is other IIIF-aware systems that can leverage the content and APIs. While this work may benefit others outside of the IIIF community directly or indirectly, the objective of the API is to specify an interoperable solution that best and most easily fulfills the discovery needs within the community of participating organizations.</p>

<p>The discovery of IIIF resources requires a consistent and well understood pattern for content providers to publish lists of links to their available content. This allows a baseline implementation of discovery systems that process the list, looking for resources that have been added or changed.</p>

<p>This process can be optimized by allowing the content providers to publish descriptions of how their content has changed, enabling consuming systems to retrieve only the resources that have been modified since they were last retrieved. These changes might include when content is deleted or otherwise becomes unavailable. Finally, for rapid synchronization, a system of notifications pushed from the publisher to a set of subscribers can reduce the amount of effort required to constantly poll multiple sources to see if anything has changed.</p>

<p>Work that is out of scope of this API includes the recommendation or creation of any descriptive metadata formats, and the recommendation or creation of metadata search APIs or protocols. The diverse domains represented within the IIIF community already have successful standards fulfilling these use cases. Also out of scope is optimization of the transmission of content, for example recommendations about transferring any source media or data between systems.</p>

<p class="warning"><strong>Change Notifications</strong><br />This specification does not include a subscription mechanism for enabling change notifications to be pushed to remote systems. Only periodic polling for the set of changes that must be processed is supported. A subscription/notification pattern may be added in a future version after implementation experience with the polling pattern has demonstrated that it would be valuable.</p>
      <h3 id="terminology">
        
        
          1.2. Terminology <a href="#terminology">#</a>
        
        
      </h3>
    

<p>The specification uses the following terms:</p>

<ul>
  <li><strong>HTTP(S)</strong>: The HTTP or HTTPS URI scheme and internet protocol.</li>
</ul>

<p>The terms <em>array</em>, <em>JSON object</em>, <em>number</em>, and <em>string</em> in this document are to be interpreted as defined by the <a href="https://tools.ietf.org/html/rfc8259" title="JSON RFC">Javascript Object Notation (JSON)</a> specification.</p>

<p>The key words <em class="rfc">must</em>, <em class="rfc">must not</em>, <em class="rfc">required</em>, <em class="rfc">shall</em>, <em class="rfc">shall not</em>, <em class="rfc">should</em>, <em class="rfc">should not</em>, <em class="rfc">recommended</em>, <em class="rfc">may</em>, and <em class="rfc">optional</em> in this document are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119" title="RFC Keywords">RFC 2119</a>.</p>
      <h2 id="overview-of-iiif-resource-discovery">
        
        
          2. Overview of IIIF Resource Discovery <a href="#overview-of-iiif-resource-discovery">#</a>
        
        
      </h2>
    

<p>In order to discover IIIF resources, the state of those resources in the systems that publish them needs to be communicated succinctly and easily to a consuming system. The consuming system can then use that information to retrieve and process the resources of interest and provide platforms that enable discovery and use. This communication takes place via the IIIF Change Discovery API, which uses the W3C <a href="https://www.w3.org/TR/activitystreams-core/">Activity Streams</a> specification to describe and serialize changes to resources. The conceptual model for those changes and the interactions between publishers and consumers are based on those identified by the <a href="http://openarchives.org/rs/toc">ResourceSync</a> framework. It is not necessary to understand either of these standards in order to use or implement the IIIF Change Discovery API, which is fully specified in this document.</p>

<p>Activities are used to describe the state of the publishing system by recording each individual change, in the order that they occur. The changes described are the creation, modification and deletion of IIIF Presentation API resources. A consuming application that is aware of all of the changes that took place in the publishing system has full knowledge of the set of resources available. IIIF <a href="/iiif-website/api/presentation/3.0/#overview-collection" title="Presentation API 3.0 Collection Type">Collections</a> and <a href="/iiif-website/api/presentation/3.0/#overview-manifest" title="Presentation API 3.0 Manifest Type">Manifests</a> are the main access points to published content and references to descriptive metadata about that content, however, Activities describing changes to other resources, such as the IIIF Image API endpoints or the descriptive metadata about the object represented, could also be published in this way. As the intended use is to inform a consuming system, rather than to display information, the Change Discovery API does not include any content intended to be rendered to end users.</p>

<p>The Presentation API does not include descriptive metadata fields, and intentionally lacks the semantics needed to implement advanced or fielded search. Instead, the Presentation API uses the <a href="/iiif-website/api/presentation/3.0/#seealso" title="seeAlso property"><code class="language-plaintext highlighter-rouge">seeAlso</code></a> property to link to external documents that can have richer and domain-specific information about the content being presented. For example, a museum object might have a <code class="language-plaintext highlighter-rouge">seeAlso</code> reference to a CIDOC-CRM or LIDO description, while a bibliographic resource might reference a Dublin Core or MODS description. These external descriptions should be used when possible to provide interfaces giving access to more precise matching algorithms.</p>

<p>This specification describes three levels of conformance that build upon each other in terms of functionality and precision of the information published. Sets of changes are published in pages, which are then aggregated into a collection per publisher. To reduce barriers to entry, care has been taken to allow for the possibility of implementing all levels using only static files on a web server, rather than requiring dynamic access to a database.</p>
      <h3 id="resources-and-their-changes">
        
        
          2.1. IIIF Resources and their Changes <a href="#resources-and-their-changes">#</a>
        
        
      </h3>
    

<p>There are three levels of conformance at which changes to IIIF resources can be described. Level 0 is simply a list of the resources available. Level 1 adds timestamps and ordering from earliest change to most recent, allowing a consuming application to work backwards through the list and stop processing once it encounters a change that it has already seen from a previous run. Level 2 adds information about the types of activities, enabling the explicit description of the creation and deletion of resources.</p>

<p>The subsections below describe first how to construct the description of the changes for each level, and then in the next section how to embed them into ordered lists.</p>
      <h4 id="level-0-basic-resource-list">
        
        
          2.1.1. Level 0: Resource References <a href="#level-0-basic-resource-list">#</a>
        
        
      </h4>
    

<p>The core information required to provide a minimally effective set of links to IIIF resources is the URIs of those resources. The order of the resources in the resulting list is unimportant, but each <em class="rfc">should</em> only appear once. This is the minimum level for any effective interoperability.</p>

<p>This minimal level 0 API approach is compatible with the levels 1 and 2 which introduce significant benefits that allow clients to better optimize their interactions.</p>

<p>If resources are deleted after being referred to in the resource list, the entire list should be republished without the reference to the deleted resource. Clients should also expect to encounter resource URIs that are out of date and no longer resolve to a IIIF Manifest or Collection, as well as activities which do not refer to IIIF resource types at all.</p>

<p>Example Level 0 Activity:</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h4 id="level-1-basic-change-list">
        
        
          2.1.2. Level 1: Resource Changes <a href="#level-1-basic-change-list">#</a>
        
        
      </h4>
    

<p>When dealing with large lists of resources, it can be useful to work with only those resources that have changed since the last time the list was processed. This is managed by the addition of a time stamp in the <code class="language-plaintext highlighter-rouge">endTime</code> property, that indicates the time at which the resource was last modified or initially created. Lists <em class="rfc">must</em> be ordered such that the most recent activities occur last. Consumers will then process the list of Activities in reverse order, from last to first, stopping when they encounter an Activity they have already processed.</p>

<p>Example Level 1 Activity:</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-20T00:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h4 id="level-2-complete-change-list">
        
        
          2.1.3. Level 2: Resource Creation, Change, Deletion and Renaming <a href="#level-2-complete-change-list">#</a>
        
        
      </h4>
    

<p>At the most detailed level, a log of all Activities that have taken place can be recorded, with the likelihood of multiple Activities per IIIF resource. Use of the additional types of “Create”, “Delete” and “Move” allows explicit description of creations, deletions and moves, enabling a synchronization process to remove resources as well as add or update them.</p>

<p>A complete change history is not required, and sometimes not even desirable. If there are many or frequent changes to a resource, an implementation <em class="rfc">may</em> omit any number of individual changes, but <em class="rfc">should</em> always  have the most recent change included in the list. Changes that are deemed to be insignificant to the publisher of the list <em class="rfc">may</em> also be omitted, such as changes that do not affect the content visible to users.</p>

<p>Example Level 2 Activity:</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Create"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-20T00:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h4 id="aggregated-activity-streams">
        
        
          2.1.4. Aggregating Activities <a href="#aggregated-activity-streams">#</a>
        
        
      </h4>
    

<p>Activities can be added to or removed at times other than when the resources they refer to are created, modified, deleted or moved. There are several use cases for this pattern, however they are all outside of the normal publication of a stream by the content owners and thus are unlikely to affect most publishing implementations. They do affect consuming applications, and the implications are documented in <a href="/iiif-website/api/discovery#activity-streams-processing-algorithm" title="Activity Streams Processing Algorithm">3.5. Activity Streams Processing Algorithm</a>.</p>

<p>The first use case is when third-party aggregators add activities harvested from different institutions, filter those activities or objects, and aggregate them into a composite stream. For example, a dinosaur aggregator might filter several natural history museum streams for only those manifests that are about dinosaurs.</p>

<p>Secondly, resources might become available or unavailable without being created or deleted. This could happen because of changes to their permissions, such as an embargo period after creation, or when resources are temporarily removed in order to be edited as part of some data cleaning or migration process.</p>

<p>Whenever an “Add” Activity is encountered, it is semantically similar to a “Create” Activity in that it is the first time that resource is mentioned in the stream. It is, therefore, expected that if there is an “Add”, then there may not be a “Create” for the same resource occurring before it. Similarly, there will be no more references to the resource after a “Remove” or “Delete”.</p>

<p>Example Add Activity:</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Add"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Added newly discovered manifest to stream"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/aggregated-changes"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-22T00:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Example Remove Activity:</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Remove"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Removed manifest from stream due to being out of scope"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"origin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/aggregated-changes"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-11-23T00:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h4 id="state-refresh-activities">
        
        
          2.1.5. State Refresh Activities <a href="#state-refresh-activities">#</a>
        
        
      </h4>
    

<p>Sometimes a publishing system will do a complete refresh of its records and re-issue an activity for every resource.  When this happens, it is a good practice to include a <code class="language-plaintext highlighter-rouge">Refresh</code> activity immediately before the <code class="language-plaintext highlighter-rouge">Update</code> activities for the resources. This allows a consuming application to stop looking for new resources beyond this point, as all of the available ones will already have been encountered. Note that the <code class="language-plaintext highlighter-rouge">Refresh</code> uses <code class="language-plaintext highlighter-rouge">startTime</code> rather than <code class="language-plaintext highlighter-rouge">endTime</code> as the datetime when it occurs, in order to ensure that it is positioned before the resource activities in the sorted stream.</p>

<p>Consuming applications that have processed the stream previously should continue to read backwards beyond this point, in order to process any Delete activities, but do not need to process other activity types.  Applications that have not processed the stream previously can simply stop when the <code class="language-plaintext highlighter-rouge">Refresh</code> activity is encountered.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refresh"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"System refresh initiated"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-21T00:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="pages-of-changes">
        
        
          2.2. Pages of Changes <a href="#pages-of-changes">#</a>
        
        
      </h3>
    

<p>The Activities are collected together into pages that together make up the entire set of changes that the publishing system is aware of. Pages reference the previous and next pages in that set, and the overall collection of which they are part. The Activities within the page are listed such that the most recent activities occur last.</p>

<p>Pages are subsequently collected together in ordered collections, described in the following section.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"partOf"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"prev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"next"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"orderedItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/9/manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-10T10:00:00Z"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/2/manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-11T16:30:00Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="collections-of-pages">
        
        
          2.3. Collections of Pages <a href="#collections-of-pages">#</a>
        
        
      </h3>
    

<p>As the number of Activities is likely too many to usefully be represented in a single Page, they are collected together into a Collection as the initial entry point. The Collection references the URIs of the first and last pages, where the first page contains the earliest activities and the last page contains the most recent.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalItems"</span><span class="p">:</span><span class="w"> </span><span class="mi">21456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"first"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"last"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-214"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="24-registries-of-collections">
        
        
          2.4. Registries of Collections <a href="#24-registries-of-collections">#</a>
        
        
      </h3>
    

<p>In order to discover the URIs for Collections, and through them the URIs of the IIIF resources, the IIIF Consortium manages a <a href="https://registry.iiif.io/" title="IIIF Change Discovery Registry">Registry of Collections</a>. This registry is itself an implementation of the Change Discovery API, however the IIIF resources are not Presentation API resources, but other Change Discovery API resources. This might include both Collections of Manifests, or other registries of Collections. The registry describes how it is managed and how to retrieve or submit content. The registry may also reference other methods of discovering IIIF content.</p>
      <h2 id="activity-streams-details">
        
        
          3. Activity Streams Details <a href="#activity-streams-details">#</a>
        
        
      </h2>
    

<p>The W3C <a href="https://www.w3.org/TR/activitystreams-core/">Activity Streams</a> specification defines a “model for representing potential and completed activities”, and is compatible with the <a href="/iiif-website/api/annex/notes/design_patterns/">design patterns</a> established for IIIF APIs. It is defined in terms of <a href="http://www.w3.org/TR/json-ld/" title="JSON-LD 1.0">JSON-LD</a> and can be seamlessly integrated with the existing IIIF APIs. The model can be used to represent activities carried out by content publishers of creating, updating, and deleting (or otherwise de-publishing) IIIF resources.</p>

<p>This section is a summary of the properties and types used by this specification, and defined by Activity Streams. This is intended to ease implementation efforts by collecting the relevant information together.</p>

<p>Properties, beyond those described in this specification, that the consuming application does not have code to process <em class="rfc">must</em> be ignored. Other properties defined by Activity Streams <em class="rfc">may</em> be used, such as <code class="language-plaintext highlighter-rouge">origin</code> or <code class="language-plaintext highlighter-rouge">instrument</code>, but there are no current use cases that would warrant their inclusion in this specification.</p>
      <h3 id="orderedcollection">
        
        
          3.1. Ordered Collection <a href="#orderedcollection">#</a>
        
        
      </h3>
    

<p>The top-most resource for managing the lists of Activities is an Ordered Collection, broken up into Ordered Collection Pages. The Collection does not directly contain any of the Activities, instead it refers to the <code class="language-plaintext highlighter-rouge">first</code> and <code class="language-plaintext highlighter-rouge">last</code> pages of the list.</p>

<p>The overall ordering of the Collection is from the oldest Activity as the first entry in the first page, to the most recent as the last entry in the last page. Consuming applications <em class="rfc">should</em> therefore start at the end and walk <strong>backwards</strong> through the list, and stop when they reach a timestamp before the time they last processed the list.</p>

<p>Content providers <em class="rfc">must</em> publish an Ordered Collection at the HTTP(S) URI listed in the <code class="language-plaintext highlighter-rouge">id</code> property of the Collection.</p>
      <h5 id="id">
        
        
          id <a href="#id">#</a>
        
        
      </h5>
    

<p>The identifier of the Ordered Collection.</p>

<p>Ordered Collections <em class="rfc">must</em> have an <code class="language-plaintext highlighter-rouge">id</code> property. The value <em class="rfc">must</em> be a string and it <em class="rfc">must</em> be an HTTP(S) URI. The JSON representation of the Ordered Collection <em class="rfc">must</em> be available at the URI.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="type-ordered-collection">
        
        
          type <a href="#type-ordered-collection">#</a>
        
        
      </h5>
    

<p>The class of the Ordered Collection.</p>

<p>Ordered Collections <em class="rfc">must</em> have a <code class="language-plaintext highlighter-rouge">type</code> property. The value <em class="rfc">must</em> be <code class="language-plaintext highlighter-rouge">OrderedCollection</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="first">
        
        
          first <a href="#first">#</a>
        
        
      </h5>
    

<p>A link to the first Ordered Collection Page for this Collection.</p>

<p>Ordered Collections <em class="rfc">should</em> have a <code class="language-plaintext highlighter-rouge">first</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and it <em class="rfc">must</em> be the HTTP(S) URI of the first page of items in the Collection. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollectionPage</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"first"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="last">
        
        
          last <a href="#last">#</a>
        
        
      </h5>
    

<p>A link to the last Ordered Collection Page for this Collection. As the client processing algorithm works backwards from the most recent to least recent, the inclusion of <code class="language-plaintext highlighter-rouge">last</code> is <em class="rfc">required</em>, but <code class="language-plaintext highlighter-rouge">first</code> is only <em class="rfc">recommended</em>.</p>

<p>Ordered Collections <em class="rfc">must</em> have a <code class="language-plaintext highlighter-rouge">last</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and it <em class="rfc">must</em> be the HTTP(S) URI of the last page of items in the Collection. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollectionPage</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"last"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-1234"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="totalitems">
        
        
          totalItems <a href="#totalitems">#</a>
        
        
      </h5>
    

<p>The total number of Activities in the entire Ordered Collection.</p>

<p>Ordered Collections <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">totalItems</code> property. The value <em class="rfc">must</em> be a non-negative integer.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"totalItems"</span><span class="p">:</span><span class="w"> </span><span class="mi">21456</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="seealso">
        
        
          seeAlso <a href="#seealso">#</a>
        
        
      </h5>
    

<p>This property is used to refer to one or more documents that semantically describe <strong>the set of resources</strong> that are being acted upon in the Activities within the Ordered Collection, rather than any particular resource referenced from within the collection. This would allow the Ordered Collection to refer to, for example, a <a href="https://www.w3.org/TR/vocab-dcat/" title="Data Catalog Vocabulary">DCAT</a> description of the dataset. For Ordered Collections that aggregate activities and/or objects from multiple sources, the referenced description should describe the complete aggregation rather than an individual source.</p>

<p>Ordered Collections <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">seeAlso</code> property. The value <em class="rfc">must</em> be an array of one or more JSON objects, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and it <em class="rfc">must</em> be the HTTP(S) URI of the description of the dataset. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">Dataset</code>. Please note that any resource that is intended to be used by software is tagged as <code class="language-plaintext highlighter-rouge">Dataset</code>, including single files. The JSON object has the same structure as in the Presentation API, and thus <em class="rfc">should</em> have the following properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">format</code>, the value of which <em class="rfc">must</em> be a string, and it <em class="rfc">must</em> be the MIME media type of the referenced description document</li>
  <li><code class="language-plaintext highlighter-rouge">label</code>, the value of which <em class="rfc">must</em> be a JSON object, following the pattern for language maps described in the <a href="/iiif-website/api/presentation/3.0/#44-language-of-property-values" title="Language of Property Values">Presentation API</a></li>
  <li><code class="language-plaintext highlighter-rouge">profile</code>, the value of which <em class="rfc">must</em> be a string containing either a value from the <a href="/iiif-website/api/registry/profiles/">profiles registry</a> or a URI</li>
</ul>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/dataset/all-dcat.jsonld"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"en"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"DCAT description of Collection"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"profile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.w3.org/ns/dcat#"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="partof">
        
        
          partOf <a href="#partof">#</a>
        
        
      </h5>
    

<p>This property is used to refer to a larger Ordered Collection, of which this Ordered Collection is part. This would allow a publisher to have thematic or temporal sets of activities, for example to have different collections of activities for their paintings from their sculptures, or their modern content from their archival content.</p>

<p>Ordered Collections <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">partOf</code> property. The value <em class="rfc">must</em> be an array of one or more JSON objects, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and it <em class="rfc">must</em> be the HTTP(S) URI of the larger collection. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollection</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"partOf"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/aggregated-changes"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>
      <h5 id="rights">
        
        
          rights <a href="#rights">#</a>
        
        
      </h5>
    

<p>A string that identifies a license or rights statement that applies to the usage of the Ordered Collection. The value <em class="rfc">must</em> be drawn from the set of <a href="https://creativecommons.org/licenses/" title="Create Commons Licenses">Creative Commons</a> license URIs, the <a href="http://rightsstatements.org/page/1.0/" title="rightsstatements.org">RightsStatements.org</a> rights statement URIs, or those added via the <a href="/iiif-website/api/presentation/3.0/#46-linked-data-context-and-extensions" title="Linked Data Context and Extensions">extension</a> mechanism. The inclusion of this property is informative, and for example could be used to display an icon representing the rights assertions.</p>

<p>The value <em class="rfc">must</em> be a string. If the value is drawn from Creative Commons or RightsStatements.org, then the string <em class="rfc">must</em> be a URI defined by that specification.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"rights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://creativecommons.org/licenses/by/4.0/"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="complete-ordered-collection-example">
        
        
          Complete Ordered Collection Example <a href="#complete-ordered-collection-example">#</a>
        
        
      </h5>
    

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalItems"</span><span class="p">:</span><span class="w"> </span><span class="mi">21456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://creativecommons.org/licenses/by/4.0/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/dataset/all-dcat.jsonld"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"en"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"DCAT description of Collection"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"profile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.w3.org/ns/dcat#"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"partOf"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/aggregated-changes"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"first"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"last"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-214"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="ordered-collection-page">
        
        
          3.2. Ordered Collection Page <a href="#ordered-collection-page">#</a>
        
        
      </h3>
    

<p>The list of Activities is ordered both from page to page by following <code class="language-plaintext highlighter-rouge">prev</code> (or <code class="language-plaintext highlighter-rouge">next</code>) relationships, and internally within the page in the <code class="language-plaintext highlighter-rouge">orderedItems</code> property. The number of entries in each page is up to the implementer, and cannot be modified at request time by the client. Pages are not required to have the same number of entries as any other page.</p>

<p>Content providers <em class="rfc">must</em> publish at least one Ordered Collection Page at the HTTP(S) URI given in the <code class="language-plaintext highlighter-rouge">id</code> property of the Page.</p>
      <h5 id="id-1">
        
        
          id <a href="#id-1">#</a>
        
        
      </h5>
    

<p>The identifier of the Collection Page.</p>

<p>Ordered Collection Pages <em class="rfc">must</em> have an <code class="language-plaintext highlighter-rouge">id</code> property. The value <em class="rfc">must</em> be a string and it <em class="rfc">must</em> be an HTTP(S) URI. The JSON representation of the Ordered Collection Page <em class="rfc">must</em> be available at the URI.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="type-ordered-collection-page">
        
        
          type <a href="#type-ordered-collection-page">#</a>
        
        
      </h5>
    

<p>The class of the Ordered Collection Page.</p>

<p>Ordered Collections <em class="rfc">must</em> have a <code class="language-plaintext highlighter-rouge">type</code> property. The value <em class="rfc">must</em> be <code class="language-plaintext highlighter-rouge">OrderedCollectionPage</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="partof-1">
        
        
          partOf <a href="#partof-1">#</a>
        
        
      </h5>
    

<p>The Ordered Collection of which this Page is a part.</p>

<p>Ordered Collection Pages <em class="rfc">should</em> have a <code class="language-plaintext highlighter-rouge">partOf</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and <em class="rfc">must</em> be the HTTP(S) URI of the Ordered Collection that this page is part of. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollection</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"partOf"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="startindex">
        
        
          startIndex <a href="#startindex">#</a>
        
        
      </h5>
    

<p>The position of the first item in this page’s <code class="language-plaintext highlighter-rouge">orderedItems</code> list, relative to the overall ordering across all pages within the Collection. The first entry in the overall list has a <code class="language-plaintext highlighter-rouge">startIndex</code> of 0. If the first page has 20 entries, the first entry on the second page would therefore be 20.</p>

<p>Ordered Collection Pages <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">startIndex</code> property. The value <em class="rfc">must</em> be a non-negative integer.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"startIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="next">
        
        
          next <a href="#next">#</a>
        
        
      </h5>
    

<p>A reference to the next page in the list of pages.</p>

<p>Ordered Collection Pages <em class="rfc">should</em> have a <code class="language-plaintext highlighter-rouge">next</code> property, unless they are the last page in the Collection. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and <em class="rfc">must</em> be the HTTP(S) URI of the following Ordered Collection Page. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollectionPage</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"next"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="prev">
        
        
          prev <a href="#prev">#</a>
        
        
      </h5>
    

<p>A reference to the previous page in the list of pages.</p>

<p>Ordered Collection Pages <em class="rfc">must</em> have a <code class="language-plaintext highlighter-rouge">prev</code> property, unless they are the first page in the Collection. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The value of the <code class="language-plaintext highlighter-rouge">id</code> property <em class="rfc">must</em> be a string, and <em class="rfc">must</em> be the HTTP(S) URI of the preceding Ordered Collection Page. The value of the <code class="language-plaintext highlighter-rouge">type</code> property <em class="rfc">must</em> be the string <code class="language-plaintext highlighter-rouge">OrderedCollectionPage</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"prev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="ordereditems">
        
        
          orderedItems <a href="#ordereditems">#</a>
        
        
      </h5>
    

<p>The Activities that are listed as part of this page. If the Activities have an <code class="language-plaintext highlighter-rouge">endTime</code> property, then they <em class="rfc">must</em> be ordered within the array from the earliest datetime to the most recent datetime, in the same way as the pages are ordered within the Ordered Collection.</p>

<p>Ordered Collection Pages <em class="rfc">must</em> have an <code class="language-plaintext highlighter-rouge">orderedItems</code> property. The value <em class="rfc">must</em> be an array, with at least one item. Each item <em class="rfc">must</em> be a JSON object, conforming to the requirements of an Activity.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"orderedItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
     </span><span class="p">{</span><span class="w">
     	</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
     	</span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     		</span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
     		</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
     	</span><span class="p">},</span><span class="w">
     	</span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-10T10:00:00Z"</span><span class="w">
     </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="complete-ordered-collection-page-example">
        
        
          Complete Ordered Collection Page Example <a href="#complete-ordered-collection-page-example">#</a>
        
        
      </h5>
    

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"startIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
  </span><span class="nl">"partOf"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/all-changes"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollection"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"prev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"next"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/page-2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OrderedCollectionPage"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"orderedItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-10T10:00:00Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="activities">
        
        
          3.3. Activities <a href="#activities">#</a>
        
        
      </h3>
    

<p>The Activities are the means of describing the changes that have occurred in the content provider’s system.</p>

<p>Content providers <em class="rfc">may</em> publish Activities separately from Ordered Collection Pages, and if so they <em class="rfc">must</em> be at the HTTP(S) URI given in the <code class="language-plaintext highlighter-rouge">id</code> property of the Activity.</p>
      <h5 id="id-2">
        
        
          id <a href="#id-2">#</a>
        
        
      </h5>
    

<p>An identifier for the Activity.</p>

<p>Activities <em class="rfc">may</em> have an <code class="language-plaintext highlighter-rouge">id</code> property. The value <em class="rfc">must</em> be a string and it <em class="rfc">must</em> be an HTTP(S) URI. The JSON representation of the Activity <em class="rfc">may</em> be available at the URI.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/1"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="type-activity">
        
        
          type <a href="#type-activity">#</a>
        
        
      </h5>
    

<p>The type of Activity.</p>

<p>This specification uses the types described in the table below.</p>

<table class="api-table" id="table-type-dfn">
  <thead>
    <tr>
      <th>Type</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Create</code></td>
      <td>The initial creation of the resource. Each resource <em class="rfc">should</em> have at most one <code class="language-plaintext highlighter-rouge">Create</code> Activity in which it is the <code class="language-plaintext highlighter-rouge">object</code>, but if the URI of the resource is re-used after a <code class="language-plaintext highlighter-rouge">Delete</code> activity, then there <em class="rfc">may</em> be more than one.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Update</code></td>
      <td>Any change to the resource. In a system that does not distinguish creation from modification, then all changes <em class="rfc">may</em> have the <code class="language-plaintext highlighter-rouge">Update</code> type.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Delete</code></td>
      <td>The deletion of the resource, or its de-publication from the web. Each resource <em class="rfc">should</em> have at most one <code class="language-plaintext highlighter-rouge">Delete</code> Activity in which it is the <code class="language-plaintext highlighter-rouge">object</code>, but <em class="rfc">may</em> have more than one if it is subsequently republished and then deleted again.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Move</code></td>
      <td>The re-publishing of the resource at a new URI, with the same content. Each resource <em class="rfc">may</em> have zero or more <code class="language-plaintext highlighter-rouge">Move</code> activities in which it is the <code class="language-plaintext highlighter-rouge">object</code> or <code class="language-plaintext highlighter-rouge">target</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Add</code></td>
      <td>The addition of an object to a stream, outside of any of the above types of activity, such as a third party aggregator adding resources from a newly discovered stream. Each resource <em class="rfc">should</em> have at most one <code class="language-plaintext highlighter-rouge">Add</code> Activity in which it is the object, but if the resource is re-added after a <code class="language-plaintext highlighter-rouge">Remove</code> activity, then there <em class="rfc">may</em> be more than one. The <code class="language-plaintext highlighter-rouge">Add</code> Activity <em class="rfc">should not</em> be present if a <code class="language-plaintext highlighter-rouge">Create</code> or <code class="language-plaintext highlighter-rouge">Update</code> Activity is present at the same time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Remove</code></td>
      <td>The removal of an object from a stream, outside of any of the above types of activity, such as a third party aggregator removing resources from a stream that are no longer considered to be in scope. Each resource <em class="rfc">should</em> have at most one <code class="language-plaintext highlighter-rouge">Remove</code> activity, but if the resource is re-added and then re-removed, then there <em class="rfc">may</em> be more than one. The <code class="language-plaintext highlighter-rouge">Remove</code> Activity <em class="rfc">should not</em> be present if a <code class="language-plaintext highlighter-rouge">Delete</code> Activity is present at the same time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Refresh</code></td>
      <td>The beginning of an activity to refresh the stream with the state of all of the resources. It does not have an <code class="language-plaintext highlighter-rouge">object</code> or <code class="language-plaintext highlighter-rouge">target</code>.</td>
    </tr>
  </tbody>
</table>

<p>Activities <em class="rfc">must</em> have the <code class="language-plaintext highlighter-rouge">type</code> property. The value <em class="rfc">must</em> be a registered Activity type, and <em class="rfc">should</em> be one of <code class="language-plaintext highlighter-rouge">Create</code>, <code class="language-plaintext highlighter-rouge">Update</code>, or <code class="language-plaintext highlighter-rouge">Delete</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="object">
        
        
          object <a href="#object">#</a>
        
        
      </h5>
    

<p>The IIIF resource that was affected by the Activity. It is an implementation decision whether there are separate lists of Activities, one per object type, or a single list with all of the object types combined.</p>

<p>In the case of the <code class="language-plaintext highlighter-rouge">Move</code> activity, the <code class="language-plaintext highlighter-rouge">object</code> property contains the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> of the source from whence it was moved. The new location will be in the <code class="language-plaintext highlighter-rouge">target</code> property, described below.</p>

<p>Activities <em class="rfc">must</em> have the <code class="language-plaintext highlighter-rouge">object</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The <code class="language-plaintext highlighter-rouge">id</code> <em class="rfc">must</em> be an HTTP(S) URI. The <code class="language-plaintext highlighter-rouge">type</code> <em class="rfc">should</em> be a class defined in the IIIF Presentation API, and <em class="rfc">should</em> be one of <code class="language-plaintext highlighter-rouge">Collection</code>, or <code class="language-plaintext highlighter-rouge">Manifest</code>.  The <code class="language-plaintext highlighter-rouge">type</code>, therefore, <em class="rfc">may</em> be any class, including those not defined by the IIIF Presentation API, and consuming applications <em class="rfc">should</em> validate the <code class="language-plaintext highlighter-rouge">type</code> as being one that is appropriate for their usage.</p>

<p>The object <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">seeAlso</code> property, as defined for <code class="language-plaintext highlighter-rouge">OrderedCollection</code> above, to reference a document that describes the object resource. The document referenced in the <code class="language-plaintext highlighter-rouge">seeAlso</code> property <em class="rfc">may</em> also be referenced with the <code class="language-plaintext highlighter-rouge">seeAlso</code> property in an instance of the IIIF Presentation API. The <code class="language-plaintext highlighter-rouge">type</code> of the document referenced in the <code class="language-plaintext highlighter-rouge">seeAlso</code> property should be given as <code class="language-plaintext highlighter-rouge">Dataset</code>, meaning that it is data rather than a human-readable document.</p>

<p>The object <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">canonical</code> property, the value of which <em class="rfc">must</em> be a string that contains a URI.  This URI identifies the resource, regardless of the URI given in the <code class="language-plaintext highlighter-rouge">id</code> property of the object, which might be specific to a format, API version or publishing platform. The use of this property allows changes to be aligned across representations without relying on <code class="language-plaintext highlighter-rouge">seeAlso</code> links or only having a single representation.</p>

<p>The object <em class="rfc">may</em> have a <code class="language-plaintext highlighter-rouge">provider</code> property, as defined by the <a href="https://iiif.io/api/presentation/3.0/#provider">IIIF Presentation API</a>. In particular, the value of the property <em class="rfc">must</em> be an array of JSON objects, each of which <em class="rfc">must</em> have the <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">label</code> attributes, carrying the URI of the provider, the string “Agent”, and the name of the provider in a language map object, respectively.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/iiif/v3/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"canonical"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/dataset/single-item.jsonld"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"en"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Object Description in Schema.Org"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"profile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://schema.org/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/about"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Agent"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"en"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Example Organization"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="target">
        
        
          target <a href="#target">#</a>
        
        
      </h5>
    

<p>The new location of the IIIF resource, after it was affected by a <code class="language-plaintext highlighter-rouge">Move</code> activity.</p>

<p><code class="language-plaintext highlighter-rouge">Move</code> activities <em class="rfc">must</em> have the <code class="language-plaintext highlighter-rouge">target</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The <code class="language-plaintext highlighter-rouge">id</code> <em class="rfc">must</em> be an HTTP(S) URI, and <em class="rfc">must</em> be different from the URI given in the <code class="language-plaintext highlighter-rouge">object</code> property’s <code class="language-plaintext highlighter-rouge">id</code>. The <code class="language-plaintext highlighter-rouge">type</code> <em class="rfc">should</em> be a class defined in the IIIF Presentation API, and <em class="rfc">should</em> be the same as the <code class="language-plaintext highlighter-rouge">object</code> property’s <code class="language-plaintext highlighter-rouge">type</code>. Other properties that are usable for the description of <code class="language-plaintext highlighter-rouge">object</code>, such as <code class="language-plaintext highlighter-rouge">seeAlso</code> and <code class="language-plaintext highlighter-rouge">canonical</code> are also available for use in describing the <code class="language-plaintext highlighter-rouge">target</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/a/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/single-item-a.jsonld"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="endtime">
        
        
          endTime <a href="#endtime">#</a>
        
        
      </h5>
    

<p>The time at which the Activity was finished. It is up to the implementer to decide whether the value of <code class="language-plaintext highlighter-rouge">endTime</code> is the timestamp for the publication of the IIIF resource online or is the timestamp of the modification to the data in the managing system if these are different, but the decision <em class="rfc">must</em> be consistently applied. The changed resource given in <code class="language-plaintext highlighter-rouge">object</code> <em class="rfc">must</em> be available at its URI at or before the timestamp given in <code class="language-plaintext highlighter-rouge">endTime</code>. The value of <code class="language-plaintext highlighter-rouge">endTime</code> <em class="rfc">should</em> be before the time that the Activity is published as part of its Ordered Collection.</p>

<p>Activities <em class="rfc">should</em> have the <code class="language-plaintext highlighter-rouge">endTime</code> property. The value <em class="rfc">must</em> be a datetime expressed in UTC in the <a href="https://www.w3.org/TR/xmlschema11-2/#dateTime" title="XSD DateTime">xsd:dateTime</a> format.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-21T00:00:00Z"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="starttime">
        
        
          startTime <a href="#starttime">#</a>
        
        
      </h5>
    

<p>The time at which the Activity was started.</p>

<p>Activities <em class="rfc">may</em> have the <code class="language-plaintext highlighter-rouge">startTime</code> property. The value <em class="rfc">must</em> be a datetime expressed in UTC in the <a href="https://www.w3.org/TR/xmlschema11-2/#dateTime" title="XSD DateTime">xsd:dateTime</a> format.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-20T23:58:00Z"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="summary">
        
        
          summary <a href="#summary">#</a>
        
        
      </h5>
    

<p>A short textual description of the Activity. This is intended primarily to be used for debugging purposes or explanatory messages, and thus does not have the requirement for internationalization of the content. The intended audience of this field is a human who manages an aggregation service and is looking at the data, not an end user of the IIIF resource. It is not recommended that this field be present as in most situations it will never be seen.</p>

<p>Activities <em class="rfc">may</em> have the <code class="language-plaintext highlighter-rouge">summary</code> property. The value <em class="rfc">must</em> be a string.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin updated the manifest, fixing reported bug #15."</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="actor">
        
        
          actor <a href="#actor">#</a>
        
        
      </h5>
    

<p>The organization, person, or software agent that carried out the Activity.</p>

<p>Activities <em class="rfc">may</em> have the <code class="language-plaintext highlighter-rouge">actor</code> property. The value <em class="rfc">must</em> be a JSON object, with the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">type</code> properties. The <code class="language-plaintext highlighter-rouge">id</code> <em class="rfc">should</em> be an HTTP(S) URI. The <code class="language-plaintext highlighter-rouge">type</code> <em class="rfc">must</em> be one of <code class="language-plaintext highlighter-rouge">Application</code>, <code class="language-plaintext highlighter-rouge">Organization</code>, or <code class="language-plaintext highlighter-rouge">Person</code>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"actor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/person/admin1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h5 id="complete-activity-example">
        
        
          Complete Activity Example <a href="#complete-activity-example">#</a>
        
        
      </h5>
    

<p>A complete example Activity would thus look like the following example. Note that it does not have a <code class="language-plaintext highlighter-rouge">@context</code> property, as it is always embedded within a <code class="language-plaintext highlighter-rouge">CollectionPage</code>. Please note also that this is a complete example with all possible fields; most implementations will not need nor expose this level of data.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/activity/1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin updated the manifest, fixing reported bug #15."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"canonical"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/dataset/single-item.jsonld"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-21T00:00:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-20T23:58:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"actor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/person/admin1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="34-linked-data-context-and-extensions">
        
        
          3.4. Linked Data Context and Extensions <a href="#34-linked-data-context-and-extensions">#</a>
        
        
      </h3>
    
      <h4 id="341-context">
        
        
          3.4.1. @context <a href="#341-context">#</a>
        
        
      </h4>
    

<p>The top level resource in the response <em class="rfc">must</em> have the <code class="language-plaintext highlighter-rouge">@context</code> property, and it <em class="rfc">should</em> appear as the very first key/value pair of the JSON representation. This property lets Linked Data processors interpret the document as a graph. The value of the property <em class="rfc">must</em> be either the URI of the IIIF Discovery context document, <code class="language-plaintext highlighter-rouge">http://iiif.io/api/discovery/1/context.json</code>, or an array of strings, where the URI of the IIIF Discovery context document is the last item in the array.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h4 id="342-extensions">
        
        
          3.4.2. Extensions <a href="#342-extensions">#</a>
        
        
      </h4>
    

<p>If any additional types or properties are desired beyond the ones defined in this specification or the ActivityStreams specification, then those types or properties <em class="rfc">should</em> be mapped to RDF terms in one or more additional context documents. These extension contexts <em class="rfc">should</em> be added to the top level <code class="language-plaintext highlighter-rouge">@context</code> property, and <em class="rfc">must</em> be before the URI of the Discovery context. The JSON-LD 1.1 functionality of defining terms only within a specific property, known as <a href="https://json-ld.org/spec/latest/json-ld/#scoped-contexts" title="JSON-LD Scoped Contexts">scoped contexts</a>, <em class="rfc">must</em> be used to minimize cross-extension collisions. Extensions intended for broad use <em class="rfc">should</em> be registered in the <a href="/iiif-website/api/registry/" title="IIIF Extension Registry">extensions registry</a>.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://example.org/extension/context.json"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://iiif.io/api/discovery/1/context.json"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h3 id="activity-streams-processing-algorithm">
        
        
          3.5. Activity Streams Processing Algorithm <a href="#activity-streams-processing-algorithm">#</a>
        
        
      </h3>
    

<p>The aim of the processing algorithm is to inform developers implementing consuming applications how to make best use of the available information. The specification does not require any particular processing of the information by the consuming application, but considers indexing of the resource as a common use case in <a href="#indexing">section 3.5.3</a>.</p>

<p>Any other algorithm that arrives at the same results as an implementation of the algorithms specified below would also be considered to be conforming. The algorithms are provided as recommendations (<em class="rfc">should</em>) rather than strict requirements in order to not overly constrain the usage or inhibit novel ideas and experimentation.</p>

<p>For processing multiple streams concurrently, there is additional processing work to be done to ensure the correct results, as the same activity might be represented in multiple streams. This is described in <a href="#processing-multiple">section 3.5.4</a>.</p>
      <h4 id="collection-algorithm">
        
        
          3.5.1. Collection Algorithm <a href="#collection-algorithm">#</a>
        
        
      </h4>
    

<p>Given the URI of an ActivityStreams Collection (<code class="language-plaintext highlighter-rouge">collection</code>) as input, a conforming processor <em class="rfc">should</em>:</p>

<!-- This should be nested * markdown... but can't figure it -->

<ol>
  <li>Initialization:
    <ol>
      <li>Let <code class="highlighter-rouge">processedItems</code> be an empty array</li>
      <li>Let <code class="highlighter-rouge">lastCrawl</code> be the timestamp of the previous time the algorithm was executed or null if this is the first time the stream has been processed</li>
      <li>Let <code class="highlighter-rouge">onlyDelete</code> be <code class="highlighter-route">False</code></li>
    </ol>
  </li>
  <li>Retrieve the representation of <code class="highlighter-rouge">collection</code> via HTTP(S)</li>
  <li>Validate that the retrieved representation contains at least the features required for processing</li>
  <li>Find the URI of the last page at <code class="highlighter-rouge">collection.last.id</code> (<code class="highlighter-rouge">pageN</code>)</li>
<li>Apply the results of the page algorithm to <code class="highlighter-rouge">pageN</code></li>
</ol>
      <h4 id="page-algorithm">
        
        
          3.5.2. Page Algorithm <a href="#page-algorithm">#</a>
        
        
      </h4>
    

<p>Given the URI of an ActivityStreams CollectionPage (<code class="language-plaintext highlighter-rouge">page</code>), a list of processed items (<code class="language-plaintext highlighter-rouge">processedItems</code>), the date of last crawling (<code class="language-plaintext highlighter-rouge">lastCrawl</code>), and a processing function (<code class="language-plaintext highlighter-rouge">process()</code>) as input, a conforming processor <em class="rfc">should</em>:</p>

<ol class="ordered-list">
  <li>Retrieve the representation of <code class="highlighter-rouge">page</code> via HTTP(S)</li>
  <li>Validate that the retrieved representation contains at least the features required for processing</li>
  <li>Find the set of updates of the page at <code class="highlighter-rouge">page.orderedItems</code> (<code class="highlighter-rouge">items</code>)</li>
  <li>In <b>reverse order</b>, iterate through the activities (<code class="highlighter-rouge">activity</code>) in <code class="highlighter-rouge">items</code>:
    <ol>
      <li>If <code class="highlighter-rouge">activity.endTime</code> is before <code class="highlighter-rouge">lastCrawl</code>, then terminate ;</li>
      <li>If <code class="highlighter-rouge">activity.type</code> is <code class="highlighter-rouge">Refresh</code>, then if <code class="highlighter-rouge">lastCrawl</code> is not null, then set <code class="highlighter-rouge">onlyDelete</code> to <code class="highlighter-rouge">True</code>, else if <code class="highlighter-rouge">lastCrawl</code> is null, then terminate;</li>
      <li>If the updated resource's URI at <code class="highlighter-rouge">activity.object.id</code> is in <code class="highlighter-rouge">processedItems</code>, then continue ;</li>
      <li>If the updated resource's class at <code class="highlighter-rouge">activity.object.type</code> is not one that is known to the processor, then continue ;</li>
      <li>Otherwise, if <code class="highlighter-rouge">activity.type</code> is <code class="highlighter-rouge">Delete</code>, or it is <code class="highlighter-rouge">Remove</code> and <code class="highlighter-rouge">activity.origin.id</code> is the URI of the current stream, then find the URI of the resource at <code class="highlighter-rouge">activity.object.id</code> and process its removal ;</li>
      <li>Otherwise, if <code class="highligher-rouge">onlyDelete</code> is <code class="highlighter-rouge">True</code>, then continue ;</li>
      <li>Otherwise, if <code class="highlighter-rouge">activity.type</code> is <code class="highlighter-rouge">Update</code> or <code class="highlighter-rouge">Create</code>, or it is <code class="highlighter-rouge">Add</code> and <code class="highlighter-rouge">activity.target.id</code> is the URI of the current stream, then find the URI of the resource at <code class="highlighter-rouge">activity.object.id</code> (<code class="highlighter-rouge">object</code>) and process its inclusion ;</li>
      <li>Otherwise, if <code class="highlighter-rouge">activity.type</code> is <code class="highlighter-rouge">Move</code>, then find the original URI of the moved resource at <code class="highlighter-rouge">activity.object</code> and process its removal, and find the new URI of the moved resource at <code class="highlighter-rouge">activity.target</code> and process its inclusion.</li>
      <li>Add the processed resource's URI to <code class="highlighter-rouge">processedItems</code></li>
    </ol>
  </li>
  <li>Finally, find the URI of the previous page at <code class="highlighter-rouge">collection.prev.id</code> (<code class="highlighter-rouge">pageN1</code>)</li>
 <li>If there is a previous page, apply the results of the page algorithm to <code class="highlighter-rouge">pageN1</code></li>
</ol>
      <h4 id="indexing">
        
        
          3.5.3. Resource Processing: Indexing <a href="#indexing">#</a>
        
        
      </h4>
    

<p>While there are many possible algorithms to process the discovered resources and activities, a core use case for the Change Discovery API is to maintain an up-to-date index of the resources.</p>

<p>In this case, the objective of the consuming application is to find accurate, machine-readable descriptive information that might be used to build an index, and thus the application <em class="rfc">should</em> use the IIIF Presentation API <code class="language-plaintext highlighter-rouge">seeAlso</code> property to retrieve such a description if available. For different types of resources, and for different domains, the referenced descriptive resources will have different formats and semantics. If there are no such descriptions, or none that can be processed, the data in the Manifest and in other IIIF resources might be used as a last resort, despite its presentational intent.</p>
      <h4 id="processing-multiple">
        
        
          3.5.4. Processing Multiple Streams <a href="#processing-multiple">#</a>
        
        
      </h4>
    

<p>In order to process multiple streams simultaneously, the steps for processing a page should be followed, but applied to the set of changes across all of the streams, sorted by the timestamp of the activity. One motivating factor for this is that the same activity might appear in multiple streams, when the activities have been broadly aggregated. For example, the same update might occur in three streams out of ten that are being processed together, and should only be processed once.</p>

<p>Implementations that process activities beyond the most recent per resource should consider two activities with the same <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">object.id</code> and <code class="language-plaintext highlighter-rouge">endTime</code> to be the same activity regardless of any other properties. In this way, duplicate activities can be detected even if different streams maintain different degrees of description and information, or some implementations have activities available at their URIs and some do not.</p>

<p>The algorithm below does not take into account any optimizations or constraints around memory or processing. A more sophisticated algorithm might process pages, relying on each being sorted, to keep an interleaved buffer of activities full, rather than retrieving and processing everything before starting to process the activities. It is not described in as much detail as the processing algorithms above for this reason.</p>

<p>Given an array (<code class="language-plaintext highlighter-rouge">collections</code>) of collection URIs as input,</p>

<ol class="ordered-list">
  <li>Initialize global values <code class="highlighter-rouge">processedItems</code> and  <code class="highlighter-rouge">lastCrawl</code> as above.</li>
  <li>Let  <code class="highlighter-rouge">allActivities</code> be an empty array.</li>
  <li>For each <code class="highlighter-rouge">collection</code> in <code class="highlighter-rouge">collections</code>:
    <ol>
      <li>Retrieve and validate the representation of <code class="highlighter-rouge">collection</code>.</li>
      <li>While there are pages with activities that have a timestamp after <code class="highlighter-rouge">lastCrawl</code>:
        <ol>
          <li>Retrieve and validate the representation of the page, and add the matching activities to <code class="highlighter-rouge">allActivities</code></li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Sort <code class="highlighter-rouge">allActivities</code> by <code class="highlighter-rouge">activity.endTime</code>, descending, removing any duplicates as described above.</li>
  <li>For each activity in <code class="highlighter-rouge">allActivities</code>, apply the page algorithm's handling of an activity.</li>
</ol>
      <h2 id="4-network-considerations">
        
        
          4. Network Considerations <a href="#4-network-considerations">#</a>
        
        
      </h2>
    
      <h3 id="41-media-type">
        
        
          4.1. Media Type <a href="#41-media-type">#</a>
        
        
      </h3>
    

<p>The base format for all responses of this API is JSON, as described above.</p>

<p>If the server receives a request with an <code class="language-plaintext highlighter-rouge">Accept</code> header, it <em class="rfc">should</em> respond following the rules of <a href="https://tools.ietf.org/html/rfc7231#section-5.3.2" title="HTTP 1.1, 5.3.2. Accept">content negotiation</a>. Note that content types provided in the <code class="language-plaintext highlighter-rouge">Accept</code> header of the request <em class="rfc">may</em> include parameters, for example <code class="language-plaintext highlighter-rouge">profile</code> or <code class="language-plaintext highlighter-rouge">charset</code>.</p>

<p>If the request does not include an <code class="language-plaintext highlighter-rouge">Accept</code> header, the HTTP <code class="language-plaintext highlighter-rouge">Content-Type</code> header of the response <em class="rfc">should</em> have the value <code class="language-plaintext highlighter-rouge">application/ld+json</code> (JSON-LD) with the <code class="language-plaintext highlighter-rouge">profile</code> parameter given as the context document: <code class="language-plaintext highlighter-rouge">http://iiif.io/api/discovery/1/context.json</code>.</p>

<pre class="urltemplate"><code class="language-none">Content-Type: application/ld+json;profile="http://iiif.io/api/discovery/1/context.json"
</code></pre>

<p>If the above <code class="language-plaintext highlighter-rouge">Content-Type</code> header value cannot be generated, then the value <em class="rfc">should</em> instead be <code class="language-plaintext highlighter-rouge">application/json</code> (regular JSON), without a <code class="language-plaintext highlighter-rouge">profile</code> parameter.</p>

<pre class="urltemplate"><code class="language-none">Content-Type: application/json
</code></pre>

<p>The HTTP server <em class="rfc">should</em> follow the <a href="https://www.w3.org/TR/cors/" title="Cross-Origin Resource Sharing">CORS requirements</a> to enable browser-based clients to retrieve the responses. Recipes for enabling CORS and conditional Content-Type headers are provided in the <a href="/iiif-website/api/annex/notes/apache/" title="Apache HTTP Server Implementation Notes">Apache HTTP Server Implementation Notes</a>. Responses <em class="rfc">should</em> be compressed by the server as there are significant performance gains to be made for very repetitive data structures.</p>
      <h3 id="42-activities-for-access-restricted-content">
        
        
          4.2. Activities for Access-Restricted Content <a href="#42-activities-for-access-restricted-content">#</a>
        
        
      </h3>
    

<p>Activities <em class="rfc">may</em> be published about content that has access restrictions. Clients <em class="rfc">must not</em> assume that they will be able to access every resource that is the object of an Activity, and <em class="rfc">must not</em> assume that it has been deleted if it is inaccessible. For example, the content might be protected by an authentication system that is denying access (an end user might be able to provide the right credentials to gain access) or there may be a temporary network outage preventing the content from being retrieved (the network will eventually be restored).</p>

<p>Content may also change from being available to being protected by access restrictions, or become available having previously been protected. There are no more specific activity types for these situations, and the publisher <em class="rfc">should</em> issue the regular <code class="language-plaintext highlighter-rouge">Update</code> or <code class="language-plaintext highlighter-rouge">Delete</code> activities accordingly.</p>
      <h3 id="43-negotiable-resources">
        
        
          4.3. Negotiable Resources <a href="#43-negotiable-resources">#</a>
        
        
      </h3>
    

<p>Some HTTP(S) URIs are able to respond with different representations of the same content in response to requests with different headers, such as the same URI being able to return both version 2 and version 3 of the IIIF Presentation API based on the Accept header. This is known as “content negotiation”, and such resources are known as “negotiable resources”. The representations that can be negotiated for are known as “variants”.</p>

<p>Negotiable resources are not supported by the Discovery API, only variants. This means that there would be one Activity entry for each of the representations that are available, and that each representation <em class="rfc">must</em> have its own URI, even if it can also be reached via the negotiable resource. In the case of negotiating for different versions of the IIIF Presentation API, the <code class="language-plaintext highlighter-rouge">format</code> property can be used to include the full media type of the resource, where the version-specific context document is given in the <code class="language-plaintext highlighter-rouge">profile</code> parameter. If there are additional descriptive resources available, each such resource would describe all of the variants, and thus the <code class="language-plaintext highlighter-rouge">seeAlso</code> property of each Activity would refer to the same descriptions, allowing the variants to be connected together.</p>

<p>Two variants of the same negotiable resource can be represented as follows.</p>

<div class="language-json-doc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"orderedItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest/v2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/metadata.xml"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json;profile=</span><span class="se">\"</span><span class="s2">https://iiif.io/api/presentation/2/context.json</span><span class="se">\"</span><span class="s2">"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-10T10:00:00Z"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/manifest/v3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Manifest"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"seeAlso"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/iiif/1/metadata.xml"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/ld+json;profile=</span><span class="se">\"</span><span class="s2">https://iiif.io/api/presentation/3/context.json</span><span class="se">\"</span><span class="s2">"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-03-10T10:00:00Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
      <h2 id="appendices">
        
        
          Appendices <a href="#appendices">#</a>
        
        
      </h2>
    
      <h3 id="acknowledgements">
        
        
          A. Acknowledgements <a href="#acknowledgements">#</a>
        
        
      </h3>
    

<p>Many thanks to the members of the <a href="/community/" title="IIIF Community">IIIF community</a> for their continuous engagement, innovative ideas, and feedback.</p>

<p>This specification is due primarily to the work of the <a href="/iiif-website/community/groups/discovery/">IIIF Discovery Technical Specification Group</a>, chaired by Antoine Isaac (Europeana), Matthew McGrattan (Digirati) and Robert Sanderson (Yale University). The IIIF Community thanks them for their leadership, and the members of the group for their tireless work.</p>
      <h3 id="change-log">
        
        
          B. Change Log <a href="#change-log">#</a>
        
        
      </h3>
    

<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2021-04-28</td>
      <td>Version 0.9.2 (unnamed)</td>
    </tr>
    <tr>
      <td>2020-09-29</td>
      <td>Version 0.9.1 (unnamed)</td>
    </tr>
    <tr>
      <td>2020-06-04</td>
      <td>Version 0.9 (unnamed)</td>
    </tr>
    <tr>
      <td>2019-11-01</td>
      <td>Version 0.4 (unnamed)</td>
    </tr>
    <tr>
      <td>2019-03-20</td>
      <td>Version 0.3 (unnamed)</td>
    </tr>
    <tr>
      <td>2018-11-12</td>
      <td>Version 0.2 (unnamed)</td>
    </tr>
    <tr>
      <td>2018-05-04</td>
      <td>Version 0.1 (unnamed)</td>
    </tr>
  </tbody>
</table>

<!-- Keep two spaces at the top of this file -->

    </div>
  </div>
</div>

    </section>
<footer id="footer" class="footer">
  <div class="container">
    <div class="columns">

      <div class="navbar-brand column is-half">
        <a class="navbar-item" href="/iiif-website/">
          <img src="/iiif-website/assets/images/logo-sm.png" alt="International Image Interoperability Framework logo" height="28">
          <span class="brand-title blue-text">International Image Interoperability Framework</span>
        </a>
        <p>International Image Interoperability Framework: A community driven image framework with well defined APIs for making the world’s image repositories interoperable and accessible</p>
      </div>
      <div class="column"></div>
      
      <div class="column menu-column">
        <h4>About</h4>
        <ul>
        
          <li>
            <a href="/iiif-website">How It Works</a>
          </li>
        
          <li>
            <a href="/iiif-website/api">Documentation</a>
          </li>
        
          <li>
            <a href="/iiif-website">Demos</a>
          </li>
        
          <li>
            <a href="/iiif-website">Tutorials</a>
          </li>
        
        </ul>
      </div>
      
      <div class="column menu-column">
        <h4>Stay Connected</h4>
        <ul>
        
          <li>
            <a href="/iiif-website">Events & News</a>
          </li>
        
          <li>
            <a href="/iiif-website">Join Newsletter</a>
          </li>
        
          <li>
            <a href="/iiif-website">Community Groups</a>
          </li>
        
          <li>
            <a href="/iiif-website">Consortium</a>
          </li>
        
        </ul>
      </div>
      
    </columns>
  </div>
</footer>
</body>
</html>
